@using Kitaprazzi.Data.Model
@using Kitaprazzi.Core.Helper
@model Kitaprazzi.Data.Model.Category
@{
    ViewBag.Title = "Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var contentList = ViewBag.ContentList as List<Content>;
    var publisherList = contentList.Select(x=>x.Publisher).Distinct();

}

<script type="text/javascript">
    // push request
    const ajaxer = (queryName, optionValue) => {
        console.log(queryName + optionValue);
        let getUrl = window.location.href;
        if (optionValue)
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const newPath = getUrl + '&' + queryName + optionValue;
                    console.log('new url ' + newPath);
                });
    }

    $(document).ready(function () {
        // pull by select
        var $select = $('.by-point');
        var query = "shortBy=";
        $select.on('change', function () {
            var value = $(this).val();
            ajaxer(query, value);
        });

        // pull by radio
        const publisherOption = $(".filter-list-content input[name='publisher']");
        var query = "publisherID=";
        publisherOption.change(function () {
            var _id = $(this).val();
            ajaxer(query, _id);
        });
        
    });
</script>

<div class="container">
    <div class="row">
        <div class="col-12 col-md-4 col-lg-3">
            <div class="filter mb">
                <div class="filter-title">SONUÇLARI FİLTRELE</div>
                <div class="row filter-list">
                    <div class="col-6 col-md-12">
                        <div class="filter-list-item">
                            <div class="filter-list-title">YAYINCIYA GÖRE</div>
                            <div class="filter-list-content">
                                @foreach (var pubilsher in publisherList)
                                {
                                    <span class="check">
                                        <label for="@pubilsher.ID">
                                            <input type="radio" name="publisher" id="@pubilsher.ID" value="@pubilsher.ID" />
                                            @pubilsher.Name
                                        </label>
                                    </span>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-12">
                        <div class="filter-list-item">
                            <div class="filter-list-title">PUANA GÖRE</div>
                            <div class="filter-list-content">
                                <span>Puana göre filtre:</span>
                                <select class="by-point">
                                    <option value="higherToLower" selected>En yüksekten düşüğe</option>
                                    <option value="lowerToHigher">En düşükten yükseğe</option>
                                </select>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-8 col-lg-9">

            <div class="row">
                <div class="col-12">
                    <div class="title-row">
                        <a href="javascript:;" title="" class="main-title">@Model.Name.ToUpper()</a>
                    </div>
                    <div class="row">
                        @foreach (var content in contentList)
                        {
                            var mainImage = content.MediaItems.FirstOrDefault(x => x.Content.ID == content.ID && x.Type == (int)ImageType.SpotImage)?? new MediaItem {Url= "/external/content/7ad586eb83f44123925e69d1965fb363.jpg" }; // standart resim eklenecek
                            <div class="col-12 col-sm-6 col-lg-4">
                                <a href="@($"/kitap/detay/{content.ID}")" title="@content.Title" class="product">
                                    <span class="product-image">
                                        <span class="product-image-wrapper">
                                            <img src="@($"{GlobalHelper.ImageAdress}{mainImage.Url}")" alt="@content.Title" />
                                        </span>
                                    </span>
                                    <span class="product-publisher">@content.Publisher.Name</span>
                                    <span class="product-category">@content.Category.Name</span>
                                    <span class="product-title">@content.Title</span>
                                    <span class="star-rating">
                                        <span class="star-rating-text">
                                            <i>KR puanı</i>
                                            @content.KitaprazziPoint
                                        </span>
                                    </span>
                                </a>
                            </div>
                        }

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>



